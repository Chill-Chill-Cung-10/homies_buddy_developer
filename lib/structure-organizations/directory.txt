lib/
├── main.dart                    # Starting point of App
├── app.dart                     # App root, MaterialApp, theme, routes
│
├── core/                         # Dùng chung toàn app
│   ├── constants/                # Chứa các biến constants dùng toàn app 
│   │   ├── app_constants.dart
│   │   └── error_codes.dart
│   │
│   ├── utils/                    # Hàm tiện ích
│   │   ├── logger.dart
│   │   ├── permission_utils.dart
│   │   └── math_utils.dart
│   │
│   ├── state_machine/            # Quản lý trạng thái ( Bluetooth, AI pipeline )
│   │   ├── base_state.dart
│   │   ├── state_machine.dart
│   │   └── transitions.dart
│   │
│   ├── exceptions/               # Trung tâm định nghĩa và xử lý lỗi riêng của app
│   │   └── app_exception.dart
│   │
│   └── platform/
│       ├── method_channels.dart # Flutter <-> Android bridge
│       └── platform_service.dart
│
├── data/                         # Tầng dữ liệu ( IOT, AI, DB ), nói chuyện với OS/ hardware
│   ├── models/                   # Dữ liệu thô (JSON, byte, raw result) chưa cần hiểu ý nghĩa
│   │   ├── sensor_data.dart      # Lấy dữ liệu từ sensor
│   │   ├── vision_result.dart    # Lấy dữ liệu từ hình ảnh
│   │   └── /device_info.dart/    # Chưa biết làm gì       
│   │
│   ├── datasources/              # Nói chuyện và giao tiếp với thế giới bên ngoài 
│   │   ├── bluetooth/            # Giao tiếp, trao đổi dữ liệu với các thiết bị Bluetooth
│   │   │   ├── bluetooth_datasource.dart # Kết nối, giao tiếp, observe dữ liệu
│   │   │   └── bluetooth_impl.dart
│   │   │
│   │   ├── vision/               # Xử lý AI thị giác 
│   │   │   ├── vision_datasource.dart
│   │   │   └── vision_impl.dart
│   │   │
│   │   └── local/                # Cache, storage
│   │       └── cache_datasource.dart
│   │
│   └── repositories/             # Gom dữ liệu, xử lý, chuẩn hóa 
│       ├── sensor_repository.dart
│       ├── vision_repository.dart
│       ├── device_repository.dart
|       └── server_repository.dart
│
├── domain/                       # Logic thuần (không phụ thuộc Flutter)
│   ├── entities/                 # Đối tượng logic 
│   │   ├── SensorEntity.dart
│   │   ├── VisionEntity.dart
|   |   └── PromptEntity.dart
│   │
│   ├── usecases/                 # Hành động cụ thể, quyết định khi nào và vì sao
│   │   ├── connect_sensor.dart
│   │   ├── stream_sensor_data.dart
│   │   └── run_vision_inference.dart
│   │
│   └── states/                   # Kiểm soát và quản lý trạng thái logic, không phải là trạng thái của UI
│       ├── sensor_state.dart
│       ├── vision_state.dart
│       └── app_flow_state.dart
│
├── presentation/                 # UI + ViewModel (Nơi Flutter sống)
│   ├── features/
│   │   ├── diagnosis/            # Tab diagnosis
│   │   │   ├── diagnosis_view.dart
│   │   │   ├── diagnosis_viewmodel.dart
│   │   │   ├── diagnosis_state.dart
│   │   │   ├── widgets/
|   |   |   ├── multi_context_scan/
|   |   |   ├── single_context_scan/
|   |   |   └── landing/
|   |   |
│   │   ├── history/              # Tab history
│   │   │   ├── history_view.dart
|   |   |   ├── history_detail_view.dart
│   │   │   ├── history_viewmodel.dart
│   │   │   ├── history_state.dart
|   |   |   └── widgets/
|   |   |   
│   │   │
│   │   └── market/               # Tab Market 
│   │       ├── market_view.dart  # UI 
|   |       ├── product_detail_view.dart
│   │       ├── market_viewmodel.dart # Logic hiển thị, gọi usecase 
│   │       ├── market_state.dart # State mà UI render
|   |       ├── widgets/
|   |       ├── supplier_map/
|   |       └── fertilizer_usage_calculator/
│   │
│   └── widgets/                  # Widgets sử dụng chung
│       ├── loading_overlay.dart
│       └── error_dialog.dart
│
├── services/                     # Dịch vụ chạy nền - Không cần service khi gọi API 1 lần/ Read Local data
│   ├── bluetooth_service.dart    # Quản lý vòng đời BLuetooth ( giữ socket, auto-retry connect, auto-cleanup)
│   ├── vision_service.dart       # Quản lý camera + AI stream
│   └── lifecycle_service.dart    # App foreground/ background - Thông báo cho Bluetooth/ vision - Sync trạng thái toàn bộ app - Lắng nghe app state
│
└── di/                           # Dependency Injection - Người mai mối
    ├── injector.dart             # get_it / riverpod - Khởi tạo & kết nối các thành phần 
    └── modules.dart              # Quy định: ViewModel dùng Repository nào
